# EV-TriFocus: 智能电动汽车充电调度仿真平台

# EV-TriFocus

## 项目概述

EV-TriFocus 是一个先进的电动汽车 (EV) 充电调度仿真平台。它旨在模拟和评估在不同场景下（用户行为、电网负载、可再生能源利用率）的各种智能充电调度算法的性能。该平台提供了一个动态的环境，用于测试和比较包括基于规则、多智能体系统 (MAS) 和强化学习 (MARL) 在内的多种调度策略，目标是优化用户满意度、运营商利润和电网友好性这三个关键维度。

项目提供了一个基于 PyQt6 的现代化桌面用户界面，包含用户面板、运营商面板和行程规划模块，支持实时仿真监控、数据可视化、预约系统和智能推荐等功能。界面设计美观，支持多区域显示和高级图表分析。

## 主要特性

* **模块化仿真环境**:
  * 模拟动态变化的电动汽车用户行为（包括出行、充电需求、SOC 变化）。
  * 模拟具有不同类型和状态的充电桩网络。
  * 模拟电网负载、可再生能源发电和实时电价。
* **可插拔的调度算法**:
  * 支持多种调度算法，方便比较和扩展：
    * **基于规则 (Rule-Based)**: 根据预定义的启发式规则和加权评分进行决策。
    * **无序充电 (Uncoordinated)**: 作为基准，模拟用户随机选择最近可用充电桩的行为。
    * **多智能体强化学习 (MARL)**: 每个充电桩作为一个智能体，通过 Q-learning 学习最优调度策略。
    * **协调式多智能体系统 (Coordinated MAS)**: 包含多个目标导向的智能体（用户满意度、运营商利润、电网友好性），通过协调器进行决策。
  * 易于添加新的自定义调度算法。
* **三维目标优化**: 核心目标是平衡用户满意度、运营商利润和电网友好性。
* **PyQt6 桌面用户界面**:
  * **用户面板**: 个人充电管理、SOC监控、行程规划、充电预约
  * **运营商面板**: 充电站管理、收益分析、设备监控、运营报告
  * **行程信息面板**: 智能路径规划、充电站推荐、实时导航
  * **高级图表**: 实时数据可视化、多维度分析、历史趋势对比
  * **预约系统**: 充电时段预约、队列管理、智能调度
* **多区域仿真支持**:
  * 支持8个区域的独立仿真和协调优化
  * 区域间负载均衡和资源共享
  * 分布式充电网络管理
* **高度可配置**:
  * 通过 `config.json` 文件可以详细配置环境参数（用户数量、充电桩类型和数量、电网特性、行为模型等）、算法特定参数、日志记录等。
* **详细的日志和结果输出**:
  * 记录详细的系统运行日志和模拟步骤数据。
  * 模拟结果以 JSON 格式保存，便于后续分析和可视化。

## 项目结构

```
EV-TriFocus/
├── algorithms/                  # 调度算法实现
│   ├── __init__.py
│   ├── coordinated_mas.py      # 协调式多智能体系统
│   ├── marl.py                 # 多智能体强化学习
│   ├── rule_based.py           # 基于规则的调度
│   └── uncoordinated.py        # 无序充电基准
├── simulation/                  # 仿真核心模块
│   ├── __init__.py
│   ├── charger_model.py        # 充电桩模型
│   ├── environment.py          # 仿真环境
│   ├── grid_model_enhanced.py  # 增强电网模型
│   ├── metrics.py              # 性能指标计算
│   ├── scheduler.py            # 调度器基类
│   ├── user_model.py           # 用户行为模型
│   └── utils.py                # 工具函数
├── models/                      # 机器学习模型存储
├── output/                      # 仿真结果输出
│   ├── simulation_result_*.json # 仿真结果文件
│   └── operator_report_*.json  # 运营商报告
├── image/                       # 项目图片资源
│   └── 作品说明书/             # 说明文档图片
├── ev_charging_gui.py          # 主GUI应用程序
├── user_panel.py               # 用户控制面板
├── operator_panel.py           # 运营商控制面板
├── trip_info_panel.py          # 行程信息面板
├── trip_planning_module.py     # 行程规划模块
├── reservation_system.py       # 预约系统
├── advanced_charts.py          # 高级图表组件
├── marl_components.py          # MARL组件
├── data_storage.py             # 数据存储管理
├── app_styles.py               # 应用样式定义
├── config.json                 # 配置文件
├── requirements.txt            # Python依赖
├── styles.qss                  # Qt样式表
├── CHANGELOG.md                # 版本更新日志
├── 作品说明书.pdf              # 项目说明文档
├── 用户面板功能指南.md         # 用户指南
└── pyqt6_user_guide.md         # PyQt6使用指南
```

* **`algorithms/`**: 包含所有调度算法的模块化实现，支持规则基础、MARL、协调式MAS等多种策略。
* **`simulation/`**: 仿真核心模块，包含环境建模、用户行为、充电桩管理、电网模型等。
* **`ev_charging_gui.py`**: 主GUI应用程序，基于PyQt6构建的现代化桌面界面。
* **`user_panel.py`**: 用户控制面板，提供个人充电管理、SOC监控、预约功能。
* **`operator_panel.py`**: 运营商控制面板，支持充电站管理、收益分析、设备监控。
* **`trip_info_panel.py`**: 行程信息面板，提供路径规划、充电站推荐、导航功能。
* **`reservation_system.py`**: 智能预约系统，支持时段预约、队列管理、冲突解决。
* **`advanced_charts.py`**: 高级图表组件，提供实时数据可视化和多维度分析。
* **`models/`**: 存储机器学习模型文件，包括MARL的Q表和深度学习模型。
* **`output/`**: 仿真结果和运营报告的输出目录。
* **`config.json`**: 系统配置文件，定义环境参数、算法设置、界面选项等。

## 安装与设置

1. **环境要求**:

   * Python 3.8+ (推荐)
   * pip (Python 包安装器)
2. **克隆仓库** (如果适用):

   ```bash
   git clone <repository_url>
   cd Ev-trifocus
   ```
3. **创建虚拟环境** (推荐):

   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/macOS
   # venv\Scripts\activate    # Windows
   ```
4. **安装依赖**:

   ```bash
   pip install -r requirements.txt
   ```

   (请确保 `requirements.txt` 文件包含了所有必要的库，例如 Flask, NumPy, (可能还有 PyTorch 用于 MARL 或其他模型)。)
5. **配置文件**:

   * 项目首次运行时，如果 `config.json` 文件不存在，系统会根据 `config_manager.py` 中的 `DEFAULT_CONFIG` 自动创建一个。
   * 您可以根据需要编辑 `config.json` 来调整模拟参数。建议先查阅 `config_manager.py` 中的默认配置结构以了解所有可配置项。

## 运行应用

### PyQt6 桌面应用

启动主GUI应用程序：

```bash
python ev_charging_gui.py
```

应用程序将打开一个现代化的桌面界面，包含以下主要功能模块：

- **仿真控制**: 启动/停止仿真，实时监控系统状态
- **多区域显示**: 支持8个区域的独立管理和协调优化
- **用户管理**: 用户行为分析、SOC监控、充电历史
- **充电站管理**: 设备状态监控、负载均衡、故障处理
- **数据可视化**: 实时图表、历史趋势、性能分析
- **智能调度**: 多种算法对比、策略优化、效果评估



```bash


### 配置选项

在启动前，可以通过修改 `config.json` 来自定义：
- 仿真环境参数（用户数量、充电站配置、区域设置）
- 调度算法参数（权重、学习率、策略选择）
- 界面显示选项（主题、图表类型、更新频率）
- 数据存储设置（数据库路径、日志级别、输出格式）

## 配置说明

系统的核心行为和参数通过 `config.json` 文件进行控制。该文件允许用户详细定制：

* **环境参数 (`environment`)**: 用户数量、类型分布、行为模式；充电站数量、充电桩类型和分布、故障率；地图边界；电网基础负载、可再生能源发电曲线、电价时段等。
* **调度器参数 (`scheduler`)**:
  * 选择要使用的 `scheduling_algorithm`。
  * 为每种算法配置特定的参数（例如，`rule_based_params`, `marl_config`, `coordinated_mas_params`）。这包括 MARL 的学习率、探索率、Q 表路径，或基于规则算法的评分权重等。
* **策略权重 (`strategies`)**: 定义不同优化目标（用户满意度、运营商利润、电网友好性）的预设权重组合，可在 UI 或 CLI 中选择。
* **模拟参数 (`simulation_params`)**: 如模拟速度控制相关的默认延迟。
* **日志参数 (`logging`)**: 日志级别和日志文件名。
* **界面参数**: 主题设置、图表配置、更新频率等GUI相关选项。
* **数据库参数**: SQLite数据库路径、连接池设置、数据保留策略。

建议在修改配置前备份原始 `config.json` 文件。

## 技术特性

### 界面技术
- **PyQt6**: 现代化的跨平台GUI框架
- **PyQtGraph**: 高性能实时数据可视化
- **自定义样式**: QSS样式表支持主题定制
- **响应式布局**: 支持窗口缩放和多屏显示

### 数据处理
- **NumPy/Pandas**: 高效的数值计算和数据分析
- **SQLite**: 轻量级数据库存储
- **JSON**: 配置和结果数据交换格式
- **多线程**: 仿真计算与界面更新分离

### 算法支持
- **规则基础调度**: 可配置权重的启发式算法
- **MARL**: 基于Q-learning的多智能体强化学习
- **协调式MAS**: 多目标优化的智能体协调
- **性能对比**: 多算法并行测试和效果评估

## 版本历史

### 最新更新 (2025-4-8)
- 系统全面优化，充电时间和效率大幅提升
- 充电桩类型和功率重新调整
- 温度影响因子和充电策略优化
- 队列管理和用户体验改进
- 详细更新内容请查看 [CHANGELOG.md](CHANGELOG.md)

## 系统要求

- **操作系统**: Windows 10/11, macOS 10.14+, Linux (Ubuntu 18.04+)
- **Python**: 3.8 或更高版本
- **内存**: 建议 8GB 以上
- **显卡**: 支持硬件加速的显卡（可选，用于图表渲染）
- **存储**: 至少 2GB 可用空间

## 贡献指南

我们欢迎各种形式的贡献！

### 如何贡献
1. Fork 本仓库
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

### 贡献方向
- 新的调度算法实现
- 界面功能增强和用户体验优化
- 性能优化和代码重构
- 文档完善和示例添加
- Bug 修复和测试用例

### 开发规范
- 遵循 PEP 8 代码风格
- 添加适当的注释和文档字符串
- 编写单元测试
- 更新相关文档



## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交 Issue
- 发起 Discussion
- 邮件联系项目维护者

