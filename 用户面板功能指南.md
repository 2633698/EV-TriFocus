# EV充电调度仿真系统 - 用户面板功能指南

## 📋 概述

用户面板是为电动汽车车主设计的核心交互界面，提供从查找充电站、了解实时状态、查看历史记录到最终完成充电的完整服务闭环。

### 🎯 核心目标
- 让用户能够方便快捷地找到最符合需求的充电站
- 获取决策所需的实时信息（位置、价格、排队情况、评价）
- 管理个人信息和充电历史
- 能够顺利启动和监控充电过程

## 🚀 快速开始

### 启动系统
```bash
# 使用新的启动脚本
python launch_ev_simulation_with_user_panel.py

# 或使用标准启动方式
python ev_charging_gui.py
```

### 基本操作流程
1. **启动仿真** - 点击左侧控制面板的"启动"按钮
2. **切换到用户面板** - 点击"👤 用户面板"选项卡
3. **暂停仿真** - 在用户面板中点击"⏸️ 暂停"
4. **选择用户** - 从左侧用户列表中选择一个用户
5. **查看推荐** - 系统自动显示充电站推荐
6. **做出决策** - 选择合适的充电站并确认
7. **继续仿真** - 点击"应用决策并继续"

## 💻 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  仿真控制                                                    │
│  [步骤滑块] [暂停] [上一步] [下一步] [应用决策并继续]          │
├──────────────┬──────────────────────────────────────────────┤
│              │  [选项卡] 用户信息│行程信息│充电历史│推荐│详情  │
│   用户列表    │                                              │
│   [筛选]     │                                              │
│   ┌─用户1    │          主要内容区域                        │
│   ├─用户2    │                                              │
│   └─用户3    │                                              │
│              │                                              │
│   当前用户    │                                              │
│   [信息]     │                                              │
└──────────────┴──────────────────────────────────────────────┘
```

## ⭐ 核心功能详解

### 1. 用户信息管理

#### 基本信息显示
- **用户ID**: 唯一标识符
- **用户类型**: 个人用户、出租车、网约车、物流车队
- **车辆型号**: sedan、SUV、truck等
- **充电偏好**: 快充优先、价格优先、均衡偏好、续航焦虑

#### 实时状态监控
- **当前状态**: 空闲、行驶中、等待充电、充电中、充电完成
- **当前位置**: GPS坐标显示
- **当前电量**: 进度条显示，颜色编码（红色<20%，橙色<50%，绿色≥50%）
- **目标电量**: 可调节的充电目标（20%-100%）

### 2. 充电历史记录

#### 月度统计
- **充电次数**: 本月总充电次数
- **总费用**: 本月充电总花费
- **平均充至**: 平均充电结束时的SOC
- **总充电量**: 累计充电电量（kWh）

#### 详细记录表
| 充电站 | 日期时间 | 充电量(kWh) | 费用(元) | 最终SOC |
|--------|----------|--------------|----------|---------|
| 充电站_1 | 01-15 14:30 | 25.6 | 38.50 | 85.2% |
| 充电站_3 | 01-14 09:15 | 18.3 | 22.80 | 78.5% |

### 3. 充电站推荐系统

#### 智能排序选项
- **综合评分**: 基于多因素算法评分
- **距离最近**: 按地理距离排序
- **价格最低**: 按充电费用排序
- **等待最短**: 按预计等待时间排序

#### 筛选条件
- **全部**: 显示所有充电站
- **快充**: 仅显示快充站点
- **慢充**: 仅显示慢充站点
- **有车位**: 仅显示有空余车位的站点
- **低价格**: 仅显示价格较低的站点

#### 推荐卡片信息
```
★ 4.2  充电站名称                    [快充] [有车位]
详细地址信息
2.5km · 8分钟                        可用 2/4
60kW · ¥1.20/度                     预计等待: 5分钟
                                    预估费用: ¥35.2
                        [导航] [选择此站]
```

### 4. 充电站详情页面

#### 基本信息
- **站点名称**: 充电站完整名称
- **详细地址**: 精确位置信息
- **运营商**: 充电站运营公司
- **营业时间**: 开放时间段

#### 实时状态
- **可用充电枪**: 当前可用数量/总数量
- **排队人数**: 当前等待用户数
- **预计等待**: 基于队列计算的等待时间
- **当前电价**: 实时电费单价

#### 设备信息
- **充电类型**: 快充、慢充、超快充
- **接口标准**: 国标、特斯拉等
- **最大功率**: 充电桩最大输出功率

#### 价格详情
| 时段 | 电费(元/度) | 服务费(元/度) |
|------|-------------|---------------|
| 峰时(7-10,18-21) | 1.20 | 0.50 |
| 平时(10-18) | 0.85 | 0.40 |
| 谷时(21-7) | 0.40 | 0.30 |

#### 用户评价
- **综合评分**: ★★★★☆ 4.2 (128条评价)
- **分项评分**:
  - 设备可用性: ★★★★☆
  - 位置便利性: ★★★★★
  - 充电速度: ★★★☆☆

### 5. 充电确认与参数设置

#### 充电参数配置
- **目标电量**: 20%-100%可调
- **充电类型**: 快充/慢充选择
- **支付方式**: 自动支付、现金支付、积分支付

#### 预估信息
- **预估时间**: 根据当前SOC和目标SOC计算
- **预估费用**: 基于电价和充电量估算
- **预估充电量**: 所需电量（kWh）

## 🎮 操作指南

### 仿真步骤控制

#### 时间轴导航
- **步骤滑块**: 拖动查看不同时间点的状态
- **步骤显示**: 当前步骤/总步骤数
- **方向按钮**: 上一步/下一步精确控制

#### 播放控制
- **暂停按钮**: ⏸️/▶️ 暂停或继续仿真
- **单步执行**: 逐步分析仿真过程
- **跳转功能**: 快速定位到特定时间点

### 用户选择与筛选

#### 筛选选项
- **全部用户**: 显示所有仿真用户
- **需要充电**: 仅显示标记为需要充电的用户
- **行驶中**: 仅显示正在行驶的用户
- **等待中**: 仅显示等待充电的用户
- **充电中**: 仅显示正在充电的用户

#### 用户信息显示
```
用户ID | 状态 | SOC百分比
user_15 | 行驶中 | SOC: 35.2%    [需要充电-红色背景]
user_23 | 等待中 | SOC: 28.7%    [等待-黄色背景]
user_41 | 充电中 | SOC: 65.1%    [充电-绿色背景]
```

### 决策制定流程

#### 1. 暂停仿真
```
点击 "⏸️ 暂停" → 仿真暂停 → 进入用户交互模式
```

#### 2. 选择目标用户
```
用户列表 → 点击用户 → 查看用户详情 → 确认选择
```

#### 3. 查看推荐
```
自动加载推荐 → 选择排序方式 → 应用筛选条件 → 浏览推荐列表
```

#### 4. 选择充电站
```
点击"选择此站" → 查看详情页面 → 确认充电站信息
```

#### 5. 配置充电参数
```
点击"立即预约/充电" → 设置目标SOC → 选择充电类型 → 确认预估信息
```

#### 6. 应用决策
```
确认充电 → 返回主界面 → 点击"应用决策并继续" → 仿真继续
```

## 🔧 高级特性

### 用户决策优先级
- **手动决策用户**: 在充电队列中享有优先权
- **决策有效期**: 30分钟内未应用的决策自动过期
- **决策验证**: 系统自动验证决策的可行性

### 智能推荐算法
- **多因素评分**: 距离、价格、等待时间、用户偏好
- **实时更新**: 推荐列表根据实时状态动态调整
- **个性化推荐**: 基于用户历史行为优化推荐

### 仿真数据同步
- **实时同步**: 用户面板与仿真引擎实时同步
- **历史回放**: 支持查看任意时间点的状态
- **决策记录**: 完整记录所有手动决策

## 📊 数据导出与分析

### 用户数据导出
```python
# 支持导出格式
{
    "selected_user": "user_15",
    "simulation_steps": 150,
    "user_sessions": [...],
    "charging_decisions": [...],
    "decision_history": [...]
}
```

### 分析指标
- **决策成功率**: 手动决策的执行成功率
- **等待时间对比**: 手动vs自动决策的等待时间
- **费用效率**: 充电费用优化效果
- **用户满意度**: 基于多维度的满意度评估

## 🐛 故障排除

### 常见问题

#### Q1: 用户面板显示空白
**解决方案**:
1. 检查仿真是否已启动
2. 确认用户数据是否加载
3. 重新选择用户

#### Q2: 推荐列表为空
**可能原因**:
- 附近没有可用充电站
- 筛选条件过于严格
- 用户位置数据异常

**解决方案**:
1. 调整筛选条件为"全部"
2. 检查地图边界设置
3. 重新刷新推荐

#### Q3: 决策无法应用
**检查项**:
- 用户状态是否适合充电
- 目标充电站是否可用
- 充电站队列是否已满

### 性能优化建议
- **用户数量**: 建议不超过100个用户同时显示
- **推荐数量**: 限制推荐列表为10-15个
- **更新频率**: 根据系统性能调整更新间隔

## 📚 开发扩展

### 添加新的筛选条件
```python
# 在StationRecommendationPanel中添加
def _applyFilters(self, stations):
    filter_type = self.filter_combo.currentText()
    
    if filter_type == "新筛选条件":
        return [s for s in stations if 满足条件(s)]
    
    # 现有筛选逻辑...
```

### 自定义推荐算法
```python
def _applySorting(self, stations):
    sort_type = self.sort_combo.currentText()
    
    if sort_type == "自定义排序":
        return sorted(stations, key=lambda s: 自定义评分函数(s))
    
    # 现有排序逻辑...
```

### 扩展用户信息
```python
# 在UserInfoPanel中添加新字段
def updateUserInfo(self, user_data):
    # 现有更新逻辑...
    
    # 添加新信息显示
    self.new_field_label.setText(user_data.get('new_field', '--'))
```

## 🎯 最佳实践

### 使用建议
1. **仿真规模**: 初次使用建议设置较小规模（50用户，10充电站）
2. **决策时机**: 在用户电量低于30%时进行手动决策效果最佳
3. **充电策略**: 根据用户类型选择合适的充电类型和目标SOC
4. **数据分析**: 定期导出数据进行对比分析

### 实验设计
1. **对照实验**: 比较手动决策vs自动调度的效果
2. **参数敏感性**: 测试不同目标SOC对系统性能的影响
3. **场景分析**: 在不同时段和负载条件下测试用户决策

### 结果解读
- **用户满意度提升**: 手动决策通常能提高特定用户的满意度
- **系统效率影响**: 分析手动决策对整体系统效率的影响
- **成本效益**: 评估个性化服务的成本效益比

---

**版本**: 2.0  
**更新日期**: 2025年5月27日 
**兼容性**: Python 3.8+, PyQt6
